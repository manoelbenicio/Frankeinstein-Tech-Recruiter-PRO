# Est치gio 1: Build (instala depend칡ncias com Poetry)
FROM python:3.10-slim as builder
WORKDIR /app

# Poetry (fixando vers칚o p/ evitar mudan칞as de CLI)
RUN pip install --no-cache-dir "poetry==1.8.3"

# Copia manifesto (usa lock se existir)
COPY pyproject.toml ./

# Instala somente deps de produ칞칚o, sem venv
RUN poetry config virtualenvs.create false \
    && poetry install --no-interaction --no-ansi --only main

# Est치gio 2: Produ칞칚o (leva as deps instaladas + c칩digo)
FROM python:3.10-slim as production
WORKDIR /app

# 游녤 leva site-packages e bin치rios do python do builder (onde Poetry instalou as libs)
COPY --from=builder /usr/local /usr/local

# Copia o c칩digo da aplica칞칚o
COPY . .

EXPOSE 8000
CMD ["uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8000"]
